[build]
  builder = "nixpacks"

# For Nixpacks build process
[phases]
  install = "npm ci"
  build = "npm run build"

[deploy]
  startCommand = "node build/server.js"
  healthcheckPath = "/health"
  healthcheckTimeout = 100
  restartPolicyType = "ON_FAILURE"
  restartPolicyMaxRetries = 10

# Environment variables for Railway
[env]
  MCP_PORT = "3002"
  NODE_ENV = "production"

[[services]]
  name = "retailcrm-mcp"

  [services.health_checks]
    path = "/health"
    port = 3002
    grace_period_seconds = 30
    interval_seconds = 10
    timeout_seconds = 5
    protocol = "http"
    
  [services.ports]
    port = 3002