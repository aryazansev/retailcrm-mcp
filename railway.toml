[build]
  builder = "nixpacks"

[deploy]
  startCommand = "node build/server.js"
  healthcheckPath = "/health"
  healthcheckTimeout = 100
  restartPolicyType = "ON_FAILURE"
  restartPolicyMaxRetries = 10

# Environment variables for Railway
[env]
  MCP_PORT = "3002"
  NODE_ENV = "production"

[[services]]
  name = "retailcrm-mcp"

  [services.health_checks]
    path = "/health"
    port = 3002
    
  [services.ports]
    port = 3002

# Railway-specific build configuration
[build.nixpacks]
  # Install TypeScript and build
  phases = [
    { name = "setup", cmd = "npm ci" },
    { name = "build", cmd = "npm run build" }
  ]